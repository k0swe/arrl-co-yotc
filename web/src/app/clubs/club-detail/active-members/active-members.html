<mat-card class="active-members-card">
  <mat-card-header>
    <mat-card-title>
      <mat-icon>groups</mat-icon>
      Active Members
    </mat-card-title>
  </mat-card-header>

  <mat-card-content>
    @if (loading()) {
      <div class="loading-container" role="status" aria-live="polite">
        <mat-spinner diameter="40"></mat-spinner>
        <p>Loading members...</p>
      </div>
    } @else if (activeMembersWithUsers().length === 0) {
      <div class="empty-state" role="status">
        <mat-icon class="empty-icon">group_off</mat-icon>
        <p>No active members yet</p>
      </div>
    } @else {
      <mat-list role="list">
        @for (item of activeMembersWithUsers(); track item.membership.userId) {
          <mat-list-item role="listitem">
            <div class="member-item">
              <mat-icon class="user-icon">person</mat-icon>
              <div class="user-details">
                @if (item.user) {
                  <span class="user-name">{{ item.user.name }} ({{ item.user.callsign }})</span>
                } @else {
                  <span class="user-name">User ID: {{ item.membership.userId }}</span>
                }
                @if (item.membership.role === 'leader') {
                  <span class="role-badge">
                    <mat-icon class="role-icon">star</mat-icon>
                    Leader
                  </span>
                }
              </div>
              @if (canManageRoles()) {
                <div class="action-buttons">
                  @if (item.membership.role === 'leader') {
                    <button
                      mat-icon-button
                      color="warn"
                      (click)="demoteToMember(item.membership.userId, item.user?.name || 'User')"
                      [attr.aria-label]="'Demote ' + (item.user?.name || 'user') + ' to regular member'"
                      matTooltip="Demote to regular member"
                    >
                      <mat-icon>arrow_downward</mat-icon>
                    </button>
                  } @else {
                    <button
                      mat-icon-button
                      color="primary"
                      (click)="promoteToLeader(item.membership.userId, item.user?.name || 'User')"
                      [attr.aria-label]="'Promote ' + (item.user?.name || 'user') + ' to club leader'"
                      matTooltip="Promote to club leader"
                    >
                      <mat-icon>arrow_upward</mat-icon>
                    </button>
                  }
                </div>
              }
            </div>
          </mat-list-item>
        }
      </mat-list>
    }
  </mat-card-content>
</mat-card>
