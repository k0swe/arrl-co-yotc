<h2 mat-dialog-title>{{ isEditMode ? 'Edit Club Details' : 'Add New Club' }}</h2>

<mat-dialog-content>
  <p class="dialog-description">
    @if (isEditMode) {
      <span>Update the club information below.</span>
    } @else {
      <span>Fill in the details for the new club.</span>
    }
  </p>

  <form [formGroup]="clubForm" (ngSubmit)="onSubmit()">
    <!-- Club Logo Upload Section -->
    <div class="logo-upload-section">
      <label class="logo-label">
        <mat-icon>image</mat-icon>
        Club Logo
      </label>
      
      @if (logoUrl()) {
        <div class="logo-preview">
          <img 
            [src]="logoUrl()" 
            alt="Club logo preview"
            class="logo-image"
          />
          <button
            mat-icon-button
            type="button"
            (click)="removeLogo()"
            class="remove-logo-button"
            aria-label="Remove logo"
          >
            <mat-icon>close</mat-icon>
          </button>
        </div>
      } @else {
        <div class="logo-upload-button">
          <input
            type="file"
            accept="image/jpeg,image/png,image/webp,image/gif"
            (change)="onLogoSelected($event)"
            #logoInput
            id="logo-input"
            class="file-input"
            aria-label="Upload club logo"
          />
          <button
            mat-stroked-button
            type="button"
            (click)="logoInput.click()"
          >
            <mat-icon>upload</mat-icon>
            Upload Logo
          </button>
          <span class="logo-hint">JPEG, PNG, WEBP, or GIF (Max 5MB)</span>
        </div>
      }
      
      @if (uploadError()) {
        <div class="upload-error" role="alert">
          <mat-icon>error</mat-icon>
          {{ uploadError() }}
        </div>
      }
    </div>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Club Name</mat-label>
      <input
        matInput
        formControlName="name"
        placeholder="e.g., Denver Radio Club"
        required
        aria-label="Club name"
      />
      <mat-icon matPrefix>groups</mat-icon>
      @if (getErrorMessage('name')) {
        <mat-error>{{ getErrorMessage('name') }}</mat-error>
      }
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Callsign</mat-label>
      <input
        matInput
        formControlName="callsign"
        placeholder="e.g., W0ABC"
        required
        aria-label="Club callsign"
      />
      <mat-icon matPrefix>radio</mat-icon>
      @if (getErrorMessage('callsign')) {
        <mat-error>{{ getErrorMessage('callsign') }}</mat-error>
      }
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Slug</mat-label>
      <input
        matInput
        formControlName="slug"
        placeholder="e.g., denver-radio-club"
        required
        aria-label="Club slug for URL"
      />
      <mat-icon matPrefix>link</mat-icon>
      @if (isClubActive) {
        <mat-hint>Slug cannot be changed once club is active</mat-hint>
      } @else if (getErrorMessage('slug')) {
        <mat-error>{{ getErrorMessage('slug') }}</mat-error>
      } @else {
        <mat-hint>URL-friendly identifier (lowercase letters, numbers, and hyphens)</mat-hint>
      }
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Location</mat-label>
      <input
        matInput
        formControlName="location"
        placeholder="e.g., Denver, CO"
        required
        aria-label="Club location"
      />
      <mat-icon matPrefix>place</mat-icon>
      @if (getErrorMessage('location')) {
        <mat-error>{{ getErrorMessage('location') }}</mat-error>
      }
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Website</mat-label>
      <input
        matInput
        formControlName="website"
        placeholder="e.g., https://example.com"
        aria-label="Club website"
      />
      <mat-icon matPrefix>link</mat-icon>
      @if (getErrorMessage('website')) {
        <mat-error>{{ getErrorMessage('website') }}</mat-error>
      }
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Description</mat-label>
      <textarea
        matInput
        formControlName="description"
        placeholder="Brief description of the club and its activities"
        rows="4"
        required
        aria-label="Club description"
      ></textarea>
      <mat-icon matPrefix>description</mat-icon>
      @if (getErrorMessage('description')) {
        <mat-error>{{ getErrorMessage('description') }}</mat-error>
      }
    </mat-form-field>
  </form>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button
    mat-button
    type="button"
    (click)="onCancel()"
    [disabled]="submitting()"
    aria-label="Cancel"
  >
    Cancel
  </button>
  <button
    mat-raised-button
    color="primary"
    type="submit"
    (click)="onSubmit()"
    [disabled]="clubForm.invalid || submitting()"
    aria-label="Save club details"
  >
    @if (uploadingLogo()) {
      <mat-spinner diameter="20" class="inline-spinner"></mat-spinner>
      <span>Uploading...</span>
    } @else if (submitting()) {
      <span>Saving...</span>
    } @else {
      <span>{{ isEditMode ? 'Save Changes' : 'Create Club' }}</span>
    }
  </button>
</mat-dialog-actions>
